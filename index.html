<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Polyglot Opening Books – ECO Galerie</title>
  <meta name="description" content="Eröffnungs-Übersicht mit ECO-Varianten, Screenshots und Downloads (Polyglot BIN)." />
  <link rel="icon" href="assets/logo.png">
  <style>
    :root{
      --bg:#0b0c10; --panel:#12131a; --muted:#9aa0a6; --text:#e9eaee;
      --accent:#e50914; --accentSoft:#ff2a2a; --ring: 0 0 0 2px rgba(229,9,20,.35);
      --radius:14px; --max:1200px; --gap:1rem;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1000px 700px at 50% -20%, #1a1214 0, var(--bg) 60%, var(--bg) 100%); color:var(--text); font:16px system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
    a{color:inherit}
    header{max-width:var(--max);margin:0 auto;padding:2.2rem 1rem 1.2rem;display:flex;align-items:center;gap:1rem}
    .logo{width:56px;height:56px;border-radius:50%;background:#1a1517 url('assets/logo.png') center/80% no-repeat; box-shadow:0 0 30px rgba(229,9,20,.35)}
    h1{margin:.1rem 0 0;font-size:clamp(1.6rem,2.5vw,2.2rem);line-height:1.15}
    .sub{color:var(--muted);margin-top:.25rem}
    main{max-width:var(--max);margin:0 auto;padding:0 1rem 3rem}

    .opening{background:linear-gradient(180deg, rgba(229,9,20,.08), transparent 140px) padding-box, var(--panel);
             border:1px solid #1e2130;border-radius:var(--radius);padding:1rem 1rem 1.2rem;margin:1.1rem 0 1.5rem}
    .op-head{display:flex;gap:1rem;align-items:flex-start;padding:.2rem .3rem .6rem .3rem}
    .op-dot{width:12px;height:12px;border-radius:50%;background:var(--accent);box-shadow:0 0 20px rgba(229,9,20,.8), inset 0 0 8px #8b0b12; margin-top:.55rem}
    .op-title{margin:0;font-size:1.2rem}
    .op-desc{margin:.3rem 0 0;color:#c9cbd3}

    .eco-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:var(--gap);padding:.3rem}
    .eco-card{display:block;position:relative;border-radius:12px;overflow:hidden;background:#0f1117;border:1px solid #222737; text-decoration:none}
    .thumb{aspect-ratio:16/10;background:#121420;display:flex;align-items:center;justify-content:center}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block;filter:contrast(1.02)}
    .badges{position:absolute;top:.6rem;left:.6rem;display:flex;gap:.4rem}
    .chip{font:600 .78rem/1.2 system-ui; padding:.35rem .5rem;border-radius:999px;background:rgba(0,0,0,.55);color:#fff;border:1px solid rgba(255,255,255,.08);backdrop-filter:blur(4px)}
    .chip.eco{background:linear-gradient(180deg, rgba(229,9,20,.9), rgba(229,9,20,.65)); border:none}
    .info{padding:.7rem .8rem .85rem;color:#dfe1e7;border-top:1px solid #1e2230;display:flex;flex-direction:column;gap:.25rem}
    .name{font-weight:650}
    .line{color:#b6bac6;font-size:.92rem}
    .hint{margin-top:.35rem;font-size:.85rem;color:#a7acb8}

    .eco-card:focus-visible,.eco-card:hover{outline:none; box-shadow:var(--ring), 0 6px 28px rgba(229,9,20,.18); transform:translateY(-1px); transition:.15s ease}
    .eco-card:active{transform:translateY(0)}
    footer{max-width:var(--max);margin:1rem auto 2.4rem;color:#a2a6b2;font-size:.92rem;padding:0 1rem}
    .kbd{border:1px solid #2a2f3f;border-radius:8px;padding:.15rem .4rem;background:#161a24;color:#e7e9ee}
  </style>
</head>
<body>
  <header>
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>Polyglot Opening Books</h1>
      <div class="sub">ECO-Galerie · Screenshot klicken ⇒ Download der passenden <b>.bin</b></div>
    </div>
  </header>

  <main id="app" aria-live="polite">
    <p>Lade Daten…</p>
  </main>

  <footer>
    Tipp: BINs mit <span class="kbd">git lfs</span> versionieren. Falls cburnett-Figuren in den Screenshots sind: „Chess piece graphics © Colin M. L. Burnett (cburnett), CC BY-SA 3.0“ in die README aufnehmen.
  </footer>

  <script>
    // Zeige alle JS-/Promise-Fehler sichtbar im UI
    (function(){
      const show = (msg) => {
        const el = document.getElementById('app');
        if (el) el.innerHTML = `<p style="color:#ff6b6b">Fehler: ${msg}</p>`;
      };
      window.addEventListener('error', e => show(e.message));
      window.addEventListener('unhandledrejection', e => show(e.reason));
    })();

    function render(openings){
      const root = document.getElementById('app');
      if(!Array.isArray(openings)){ root.innerHTML = 'openings.json ist kein Array.'; return; }
      if(openings.length===0){ root.innerHTML = 'Keine Einträge in <code>data/openings.json</code>.'; return; }
      root.innerHTML = openings.map(op => {
        const cards = (op.items||[]).map(it => `
          <a class="eco-card" href="${it.file}" download title="Download ${it.eco??''} – ${it.name??''}">
            <div class="thumb"><img loading="lazy" src="${it.image}" alt="Screenshot ${it.eco??''}: ${it.name??''}"></div>
            <div class="badges">
              ${it.eco ? `<span class="chip eco">${it.eco}</span>` : ''}
              ${it.size ? `<span class="chip">${it.size}</span>` : ''}
            </div>
            <div class="info">
              <div class="name">${it.name??'Unbenannt'}</div>
              ${it.line ? `<div class="line">${it.line}</div>` : ''}
              <div class="hint">Klicken zum Download</div>
            </div>
          </a>`).join('');
        return `
          <section class="opening" id="${op.id}">
            <div class="op-head">
              <div class="op-dot" aria-hidden="true"></div>
              <div>
                <h2 class="op-title">${op.title}</h2>
                ${op.desc ? `<p class="op-desc">${op.desc}</p>` : ''}
              </div>
            </div>
            <div class="eco-grid">${cards}</div>
          </section>`;
      }).join('');
    }

    (async () => {
      const root = document.getElementById('app');
      const url = 'data/openings.json?v=' + Date.now(); // Cache-Buster
      root.textContent = 'Lade Daten…';
      try {
        const res = await fetch(url, { cache: 'no-store' });
        if (!res.ok) throw new Error(`${url} → HTTP ${res.status}`);
        const text = await res.text();
        try {
          const json = JSON.parse(text);
          render(json);
        } catch (parseErr) {
          root.innerHTML = `<p>JSON-Fehler in <code>data/openings.json</code>:</p>
                            <pre style="white-space:pre-wrap">${String(parseErr)}</pre>`;
          console.error('JSON content was:', text);
        }
      } catch (e) {
        root.innerHTML = `<p>Konnte <code>${url}</code> nicht laden:<br><small>${String(e)}</small></p>`;
      }
    })();
  </script>
</body>
</html>
